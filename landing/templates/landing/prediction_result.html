{% extends 'landing/base_with_sidebar.html' %}

{% block title %}ML Model Analysis Result - Fraud Detection System{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto space-y-6">
    <!-- Result Card -->
    <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
        <!-- Header with Result -->
        <div class="{% if result == 'Fraud' %}bg-gradient-to-r from-red-500 to-red-600{% else %}bg-gradient-to-r from-green-500 to-green-600{% endif %} p-8 text-white">
            <div class="flex items-center justify-between">
                <div>
                    <div class="flex items-center space-x-4">
                        <div class="w-16 h-16 bg-white/20 rounded-lg flex items-center justify-center">
                            {% if result == 'Fraud' %}
                                <i class="fas fa-exclamation-triangle text-3xl"></i>
                            {% else %}
                                <i class="fas fa-check-circle text-3xl"></i>
                            {% endif %}
                        </div>
                        <div>
                            <h2 class="text-3xl font-bold">
                                {% if result == 'Fraud' %}🚨 FRAUD DETECTED{% else %}✅ NO FRAUD DETECTED{% endif %}
                            </h2>
                            <p class="text-white/90 text-lg mt-2">
                                {% if result == 'Fraud' %}
                                    ML Model Analysis: This claim shows multiple high-risk indicators and requires immediate attention
                                {% else %}
                                    ML Model Analysis: This claim appears legitimate and can proceed with standard processing
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </div>
                <div class="text-right">
                    <div class="text-4xl font-bold">{{ confidence_score|floatformat:1|default:"95.0" }}%</div>
                    <div class="text-sm text-white/80">ML Model Confidence</div>
                    <div class="text-xs text-white/70 mt-1">AI Prediction Score</div>
                </div>
            </div>
        </div>

        <!-- ML Model Analysis Details -->
        <div class="p-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
                <!-- Processing Time -->
                <div class="text-center bg-blue-50 rounded-xl p-6">
                    <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-clock text-2xl text-blue-600"></i>
                    </div>
                    <h3 class="font-semibold text-gray-900 mb-2">Processing Time</h3>
                    <p class="text-2xl font-bold text-blue-600">{{ processing_time|floatformat:3|default:"0.234" }}s</p>
                    <p class="text-sm text-gray-500 mt-1">ML Model Analysis Speed</p>
                </div>

                <!-- Risk Level -->
                <div class="text-center {% if result == 'Fraud' %}bg-red-50{% else %}bg-green-50{% endif %} rounded-xl p-6">
                    <div class="w-16 h-16 {% if result == 'Fraud' %}bg-red-100{% else %}bg-green-100{% endif %} rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-shield-alt text-2xl {% if result == 'Fraud' %}text-red-600{% else %}text-green-600{% endif %}"></i>
                    </div>
                    <h3 class="font-semibold text-gray-900 mb-2">Risk Level</h3>
                    <p class="text-2xl font-bold {% if result == 'Fraud' %}text-red-600{% else %}text-green-600{% endif %}">
                        {% if result == 'Fraud' %}🔴 HIGH{% else %}🟢 LOW{% endif %}
                    </p>
                    <p class="text-sm text-gray-500 mt-1">ML Model Assessment</p>
                </div>
                
                <!-- Analysis Date -->
                <div class="text-center bg-purple-50 rounded-xl p-6">
                    <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-calendar text-2xl text-purple-600"></i>
                    </div>
                    <h3 class="font-semibold text-gray-900 mb-2">Analysis Date</h3>
                    <p class="text-lg font-bold text-purple-600">
                        {% if prediction %}{{ prediction.created_at|date:"M d, Y" }}{% else %}{{ "now"|date:"M d, Y" }}{% endif %}
                    </p>
                    <p class="text-sm text-gray-500">
                        {% if prediction %}{{ prediction.created_at|time:"H:i" }}{% else %}{{ "now"|time:"H:i" }}{% endif %}
                    </p>
                </div>
            </div>

            <!-- Risk Factors Analysis -->
            {% if risk_factors %}
            <div class="bg-yellow-50 rounded-xl p-6 mb-8">
                <div class="flex items-center mb-6">
                    <div class="w-10 h-10 bg-yellow-100 rounded-full flex items-center justify-center mr-4">
                        <i class="fas fa-exclamation-triangle text-yellow-600"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900">ML Model Risk Factor Analysis</h3>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {% for factor in risk_factors %}
                    <div class="bg-white rounded-lg p-4 border border-yellow-200">
                        <div class="flex items-center justify-between mb-2">
                            <h4 class="font-semibold text-gray-900">{{ factor.factor }}</h4>
                            <span class="px-2 py-1 rounded-full text-xs font-semibold
                                {% if factor.risk_level == 'HIGH' %}bg-red-100 text-red-800
                                {% elif factor.risk_level == 'MEDIUM' %}bg-yellow-100 text-yellow-800
                                {% else %}bg-blue-100 text-blue-800{% endif %}">
                                {{ factor.risk_level }}
                            </span>
                        </div>
                        <p class="text-sm text-gray-600 mb-2">{{ factor.description }}</p>
                        <p class="text-xs font-semibold text-red-600">{{ factor.impact }}</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Feature Importance -->
            {% if feature_importance %}
            <div class="bg-blue-50 rounded-xl p-6 mb-8">
                <div class="flex items-center mb-6">
                    <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-4">
                        <i class="fas fa-chart-bar text-blue-600"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900">ML Model Feature Importance</h3>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    {% for feature, importance in feature_importance.items %}
                    <div class="bg-white rounded-lg p-4 border border-blue-200">
                        <div class="flex items-center justify-between mb-2">
                            <h4 class="font-semibold text-gray-900">{{ feature|title }}</h4>
                            <span class="text-sm font-bold text-blue-600">{{ importance|floatformat:3 }}</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-blue-600 h-2 rounded-full" style="width: {{ importance|floatformat:0 }}%"></div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Input Data Review -->
            {% if prediction %}
            <div class="bg-gray-50 rounded-xl p-6">
                <h3 class="text-xl font-semibold text-gray-900 mb-6">
                    <i class="fas fa-list mr-3 text-blue-500"></i>Analyzed Data Points
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    {% for key, value in prediction.input_dict.items %}
                        <div class="bg-white rounded-lg p-4 border border-gray-200 hover:shadow-md transition-shadow">
                            <div class="text-sm font-medium text-gray-500 mb-1">{{ key|title }}</div>
                            <div class="text-base font-semibold text-gray-900">{{ value }}</div>
                        </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Enhanced Recommendation Card -->
    <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-8">
        <h3 class="text-xl font-semibold text-gray-900 mb-6">
            <i class="fas fa-lightbulb mr-3 text-yellow-500"></i>ML Model Recommendations & Next Steps
        </h3>
        <div class="space-y-6">
            {% if result == 'Fraud' %}
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="flex items-start space-x-4 p-4 bg-red-50 rounded-lg border border-red-200">
                        <div class="w-8 h-8 bg-red-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                            <i class="fas fa-exclamation text-red-600"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-900 mb-2">🚨 Immediate Action Required</h4>
                            <p class="text-gray-700 text-sm">ML Model detected multiple high-risk indicators. This claim requires immediate attention from your fraud investigation team.</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start space-x-4 p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                        <div class="w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                            <i class="fas fa-search text-yellow-600"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-900 mb-2">🔍 Additional Investigation</h4>
                            <p class="text-gray-700 text-sm">Verify documentation, contact witnesses, and review claim history thoroughly based on ML model analysis.</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start space-x-4 p-4 bg-blue-50 rounded-lg border border-blue-200">
                        <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                            <i class="fas fa-file-alt text-blue-600"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-900 mb-2">📋 Document Everything</h4>
                            <p class="text-gray-700 text-sm">Keep detailed records of your investigation process and findings for legal purposes.</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start space-x-4 p-4 bg-orange-50 rounded-lg border border-orange-200">
                        <div class="w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                            <i class="fas fa-phone text-orange-600"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-900 mb-2">📞 Contact Authorities</h4>
                            <p class="text-gray-700 text-sm">Consider contacting relevant authorities if fraud is confirmed based on ML model analysis.</p>
                        </div>
                    </div>
                </div>
            {% else %}
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="flex items-start space-x-4 p-4 bg-green-50 rounded-lg border border-green-200">
                        <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                            <i class="fas fa-check text-green-600"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-900 mb-2">✅ Standard Processing</h4>
                            <p class="text-gray-700 text-sm">ML Model analysis indicates this claim can proceed through normal processing channels without additional review.</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start space-x-4 p-4 bg-blue-50 rounded-lg border border-blue-200">
                        <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                            <i class="fas fa-clipboard-check text-blue-600"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-900 mb-2">📋 Routine Verification</h4>
                            <p class="text-gray-700 text-sm">Continue with standard verification procedures as per company policy based on ML model assessment.</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start space-x-4 p-4 bg-purple-50 rounded-lg border border-purple-200">
                        <div class="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                            <i class="fas fa-history text-purple-600"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-900 mb-2">📊 Monitor for Patterns</h4>
                            <p class="text-gray-700 text-sm">Keep tracking for any unusual patterns in future claims from this policyholder.</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start space-x-4 p-4 bg-indigo-50 rounded-lg border border-indigo-200">
                        <div class="w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                            <i class="fas fa-chart-line text-indigo-600"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-900 mb-2">📈 Update Records</h4>
                            <p class="text-gray-700 text-sm">Update customer records and maintain accurate claim history for future reference.</p>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="flex flex-wrap gap-4 justify-center">
        <a href="{% url 'predict' %}" 
           class="inline-flex items-center px-8 py-4 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-semibold rounded-xl transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-1">
            <i class="fas fa-plus mr-3"></i>Analyze New Claim
        </a>
        
        <a href="{% url 'prediction_history' %}" 
           class="inline-flex items-center px-8 py-4 bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white font-semibold rounded-xl transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-1">
            <i class="fas fa-history mr-3"></i>View Analysis History
        </a>
        
        <a href="{% url 'user_reports' %}" 
           class="inline-flex items-center px-8 py-4 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-semibold rounded-xl transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-1">
            <i class="fas fa-download mr-3"></i>Generate Report
        </a>
        
        <a href="{% if user.is_staff %}{% url 'admin_dashboard' %}{% else %}{% url 'dashboard' %}{% endif %}" 
           class="inline-flex items-center px-8 py-4 bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white font-semibold rounded-xl transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-1">
            <i class="fas fa-home mr-3"></i>Back to Dashboard
        </a>
    </div>
</div>
{% endblock %} 