<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Fraud Detection System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Simple Admin Header -->
    <header class="bg-white shadow-sm border-b border-gray-200 px-6 py-4">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <div class="w-10 h-10 bg-gradient-to-br from-red-500 to-orange-600 rounded-lg flex items-center justify-center">
                    <i class="fas fa-shield-alt text-xl text-white"></i>
                </div>
                <div>
                    <h1 class="text-2xl font-bold text-gray-900">Admin - Fraud Detection System</h1>
                    <p class="text-sm text-gray-500">ML Model Analytics & Management</p>
                </div>
            </div>
            
            <div class="flex items-center space-x-4">
                <span class="text-sm text-gray-600">Welcome, {{ user.username }}</span>
                <a href="{% url 'dashboard' %}" class="bg-blue-50 hover:bg-blue-100 text-blue-600 px-4 py-2 rounded-lg transition-colors text-sm">
                    <i class="fas fa-arrow-left mr-2"></i>Back to User Dashboard
                </a>
                <a href="{% url 'logout' %}" class="bg-red-50 hover:bg-red-100 text-red-600 px-4 py-2 rounded-lg transition-colors text-sm">
                    <i class="fas fa-sign-out-alt mr-2"></i>Logout
                </a>
            </div>
        </div>
    </header>

    <div class="p-6">
        <!-- ML Model Stats -->
        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6 mb-8">
            <!-- Total Predictions -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Total Predictions</p>
                        <h3 class="text-3xl font-bold text-gray-900 mt-1">{{ total_predictions }}</h3>
                        <p class="text-blue-600 text-sm mt-1">
                            <i class="fas fa-brain text-xs"></i> ML Powered
                        </p>
                    </div>
                    <div class="bg-blue-100 p-3 rounded-lg">
                        <i class="fas fa-chart-line text-2xl text-blue-600"></i>
                    </div>
                </div>
            </div>

            <!-- Fraud Cases -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Fraud Cases Detected</p>
                        <h3 class="text-3xl font-bold text-gray-900 mt-1">{{ fraud_cases }}</h3>
                        <p class="text-red-600 text-sm mt-1">
                            <i class="fas fa-exclamation-triangle text-xs"></i> {{ fraud_rate }}% rate
                        </p>
                    </div>
                    <div class="bg-red-100 p-3 rounded-lg">
                        <i class="fas fa-shield-alt text-2xl text-red-600"></i>
                    </div>
                </div>
            </div>

            <!-- Model Accuracy -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Model Accuracy</p>
                        <h3 class="text-3xl font-bold text-gray-900 mt-1">{{ model_accuracy }}%</h3>
                        <p class="text-green-600 text-sm mt-1">
                            <i class="fas fa-check text-xs"></i> High Performance
                        </p>
                    </div>
                    <div class="bg-green-100 p-3 rounded-lg">
                        <i class="fas fa-bullseye text-2xl text-green-600"></i>
                    </div>
                </div>
            </div>

            <!-- Total Users -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">System Users</p>
                        <h3 class="text-3xl font-bold text-gray-900 mt-1">{{ total_users }}</h3>
                        <p class="text-purple-600 text-sm mt-1">
                            <i class="fas fa-users text-xs"></i> Active accounts
                        </p>
                    </div>
                    <div class="bg-purple-100 p-3 rounded-lg">
                        <i class="fas fa-users text-2xl text-purple-600"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- Fraud Detection Chart -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="mb-6">
                    <h5 class="text-lg font-semibold text-gray-900 mb-1">
                        <i class="fas fa-chart-pie text-red-500 mr-2"></i>Fraud Detection Results
                    </h5>
                    <p class="text-gray-500 text-sm">Distribution of legitimate vs fraudulent claims</p>
                </div>
                <canvas id="fraudChart" height="200"></canvas>
            </div>

            <!-- ML Performance Chart -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="mb-6">
                    <h5 class="text-lg font-semibold text-gray-900 mb-1">
                        <i class="fas fa-brain text-purple-500 mr-2"></i>ML Model Performance
                    </h5>
                    <p class="text-gray-500 text-sm">Model accuracy metrics</p>
                </div>
                <canvas id="performanceChart" height="200"></canvas>
            </div>
        </div>

        <!-- Admin Actions -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- System Management -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h5 class="text-lg font-semibold text-gray-900 mb-4">
                    <i class="fas fa-cogs text-blue-500 mr-2"></i>System Management
                </h5>
                <div class="space-y-3">
                    <a href="{% url 'admin_user_management' %}" class="flex items-center w-full p-3 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors text-blue-700">
                        <i class="fas fa-users mr-3"></i>
                        <span>Manage Users</span>
                    </a>
                    <a href="{% url 'admin_activity_logs' %}" class="flex items-center w-full p-3 bg-green-50 hover:bg-green-100 rounded-lg transition-colors text-green-700">
                        <i class="fas fa-list-alt mr-3"></i>
                        <span>Activity Logs</span>
                    </a>
                    <a href="{% url 'admin_system_settings' %}" class="flex items-center w-full p-3 bg-purple-50 hover:bg-purple-100 rounded-lg transition-colors text-purple-700">
                        <i class="fas fa-settings mr-3"></i>
                        <span>System Settings</span>
                    </a>
                </div>
            </div>

            <!-- ML Model Info -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h5 class="text-lg font-semibold text-gray-900 mb-4">
                    <i class="fas fa-brain text-orange-500 mr-2"></i>ML Model Status
                </h5>
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600">Model Version</span>
                        <span class="text-sm font-semibold">{{ ml_insights.model_version }}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600">Last Trained</span>
                        <span class="text-sm font-semibold">{{ ml_insights.last_trained }}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600">Training Data</span>
                        <span class="text-sm font-semibold">{{ ml_insights.training_data_size }} records</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600">Status</span>
                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">
                            <i class="fas fa-check-circle mr-1"></i>Active
                        </span>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h5 class="text-lg font-semibold text-gray-900 mb-4">
                    <i class="fas fa-clock text-indigo-500 mr-2"></i>Recent Activity
                </h5>
                <div class="space-y-3">
                    {% for activity in recent_activities|slice:":5" %}
                    <div class="flex items-center space-x-3 p-2 bg-gray-50 rounded-lg">
                        <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-user text-blue-600 text-xs"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-sm font-medium text-gray-900 truncate">{{ activity.user.username }}</p>
                            <p class="text-xs text-gray-500">{{ activity.get_activity_type_display }}</p>
                        </div>
                        <div class="text-xs text-gray-400">
                            {{ activity.created_at|timesince }} ago
                        </div>
                    </div>
                    {% empty %}
                    <div class="text-center py-4 text-gray-500">
                        <i class="fas fa-inbox text-2xl mb-2 opacity-50"></i>
                        <p class="text-sm">No recent activity</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <script>
        // Fraud Detection Chart
        const fraudCtx = document.getElementById('fraudChart').getContext('2d');
        new Chart(fraudCtx, {
            type: 'doughnut',
            data: {
                labels: ['Legitimate Claims', 'Fraudulent Claims'],
                datasets: [{
                    data: [{{ legitimate_cases }}, {{ fraud_cases }}],
                    backgroundColor: ['#10b981', '#ef4444'],
                    borderWidth: 2,
                    borderColor: '#ffffff'
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });

        // Performance Chart
        const performanceCtx = document.getElementById('performanceChart').getContext('2d');
        new Chart(performanceCtx, {
            type: 'bar',
            data: {
                labels: ['Accuracy', 'Precision', 'Recall', 'F1-Score'],
                datasets: [{
                    label: 'Performance %',
                    data: [
                        {{ fraud_analytics.model_performance.accuracy }},
                        {{ fraud_analytics.model_performance.precision }},
                        {{ fraud_analytics.model_performance.recall }},
                        {{ fraud_analytics.model_performance.f1_score }}
                    ],
                    backgroundColor: ['#8b5cf6', '#3b82f6', '#10b981', '#f59e0b'],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            callback: function(value) {
                                return value + '%';
                            }
                        }
                    }
                }
            }
        });
    </script>
</body>
</html>

