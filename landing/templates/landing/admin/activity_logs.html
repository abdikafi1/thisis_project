{% extends 'landing/admin/base.html' %}

{% block title %}Activity Logs{% endblock %}
{% block page_title %}Activity Logs{% endblock %}

{% block content %}


<!-- Enhanced Filter Form -->
<div class="filter-section mb-4">
    <div class="card enhanced-card">
        <div class="card-header">
        <h5 class="card-title mb-0" style="color: white;">
            <i class="fas fa-filter me-2"></i>Filter
        </h5>
    </div>
        <div class="card-body">
        <form method="get" class="row g-3 align-items-end" id="filterForm">
            
            <div class="col-lg-3 col-md-6">
                <div class="form-group-wrapper">
                    <label for="activity_type" class="form-label">
                        <i class="fas fa-tag me-1"></i>Activity Type
                    </label>
                    <select name="activity_type" id="activity_type" class="form-select enhanced-select admin-select">
                        <option value="" {% if not request.GET.activity_type %}selected{% endif %}>üìä All Activities</option>
                        <option value="login" {% if request.GET.activity_type == 'login' %}selected{% endif %} 
                                style="background-color: #e3f2fd; color: #1565c0;" 
                                onmouseover="this.style.backgroundColor='#00bcd4'; this.style.color='white';" 
                                onmouseout="this.style.backgroundColor='#e3f2fd'; this.style.color='#1565c0';">
                            üîê Login
                        </option>
                        <option value="prediction" {% if request.GET.activity_type == 'prediction' %}selected{% endif %}
                                style="background-color: #e8f5e8; color: #2e7d32;"
                                onmouseover="this.style.backgroundColor='#00bcd4'; this.style.color='white';" 
                                onmouseout="this.style.backgroundColor='#e8f5e8'; this.style.color='#2e7d32';">
                            üîç Prediction
                        </option>
                        <option value="report_export" {% if request.GET.activity_type == 'report_export' %}selected{% endif %}
                                style="background-color: #fff3e0; color: #ef6c00;"
                                onmouseover="this.style.backgroundColor='#00bcd4'; this.style.color='white';" 
                                onmouseout="this.style.backgroundColor='#fff3e0'; this.style.color='#ef6c00';">
                            üìÑ Report Export
                        </option>
                        <option value="settings_change" {% if request.GET.activity_type == 'settings_change' %}selected{% endif %}
                                style="background-color: #f3e5f5; color: #7b1fa2;"
                                onmouseover="this.style.backgroundColor='#00bcd4'; this.style.color='white';" 
                                onmouseout="this.style.backgroundColor='#f3e5f5'; this.style.color='#7b1fa2';">
                            ‚öôÔ∏è Settings Change
                        </option>
                        <option value="admin_action" {% if request.GET.activity_type == 'admin_action' %}selected{% endif %}
                                style="background-color: #ffebee; color: #c62828;"
                                onmouseover="this.style.backgroundColor='#00bcd4'; this.style.color='white';" 
                                onmouseout="this.style.backgroundColor='#ffebee'; this.style.color='#c62828';">
                            üëë AdminAction
                        </option>
                    </select>
                    <small class="form-text text-muted">Select specific activity type or leave as "All Activities" to see everything</small>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="form-group-wrapper">
                    <label for="date_from" class="form-label">
                        <i class="fas fa-calendar-alt me-1"></i>Date From
                    </label>
                    <input type="date" name="date_from" id="date_from" class="form-control enhanced-input" 
                           value="{{ request.GET.date_from }}" max="{{ today_date }}">
                    <div class="invalid-feedback" id="date_from_error"></div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="form-group-wrapper">
                    <label for="date_to" class="form-label">
                        <i class="fas fa-calendar-alt me-1"></i>Date To
                    </label>
                    <input type="date" name="date_to" id="date_to" class="form-control enhanced-input" 
                           value="{{ request.GET.date_to }}" max="{{ today_date }}">
                    <div class="invalid-feedback" id="date_to_error"></div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="form-group-wrapper">
                    <label class="form-label">&nbsp;</label>
                    <button type="submit" class="btn btn-primary w-100 enhanced-btn" id="applyFiltersBtn"
                            onmouseover="this.style.backgroundColor='#0056b3'; this.style.color='white'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,86,179,0.3)';" 
                            onmouseout="this.style.backgroundColor='#007bff'; this.style.color='white'; this.style.transform='translateY(0px)'; this.style.boxShadow='0 2px 6px rgba(0,123,255,0.2)';">
                        <i class="fas fa-search me-2"></i>Apply Filters
                    </button>
                </div>
            </div>
        </form>
        
            {% if request.GET.activity_type or request.GET.date_from or request.GET.date_to %}
                <div class="active-filters mt-4 pt-3 border-top">
                    <div class="d-flex flex-wrap gap-3 align-items-center">
                        <span class="filter-label">Active filters:</span>
                        {% if request.GET.activity_type %}
                            <span class="filter-badge">
                                <i class="fas fa-tag me-1"></i>{{ request.GET.activity_type|title }}
                                <a href="?{% if request.GET.date_from %}date_from={{ request.GET.date_from }}&{% endif %}{% if request.GET.date_to %}date_to={{ request.GET.date_to }}{% endif %}" class="remove-filter">√ó</a>
                            </span>
                        {% endif %}
                        {% if request.GET.date_from or request.GET.date_to %}
                            <span class="filter-badge">
                                <i class="fas fa-calendar me-1"></i>
                                {% if request.GET.date_from and request.GET.date_to %}
                                    {{ request.GET.date_from }} to {{ request.GET.date_to }}
                                {% elif request.GET.date_from %}
                                    From {{ request.GET.date_from }}
                                {% elif request.GET.date_to %}
                                    Until {{ request.GET.date_to }}
                                {% endif %}
                                <a href="?{% if request.GET.activity_type %}activity_type={{ request.GET.activity_type }}{% endif %}" class="remove-filter">√ó</a>
                            </span>
                        {% endif %}
                        <a href="{% url 'admin_activity_logs' %}" class="filter-badge clear-all">
                            <i class="fas fa-times me-1"></i>Clear all
                        </a>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
<!-- Enhanced Quick Stats Cards -->
<!-- <div class="stats-section mb-4">
    <div class="d-flex flex-wrap gap-3">
        <div class="stat-card total-activities">
            <div class="stat-icon">
                <i class="fas fa-list-alt"></i>
                </div>
            <div class="stat-content">
                <h3 class="stat-number">{{ page_obj.paginator.count }}</h3>
                <p class="stat-label">Total Activities</p>
            </div>
                </div>
        <div class="stat-card showing-activities">
            <div class="stat-icon">
                <i class="fas fa-eye"></i>
            </div>
            <div class="stat-content">
                <h3 class="stat-number">{{ activities|length }}</h3>
                <p class="stat-label">Showing</p>
                </div>
            </div>
        <div class="stat-card current-page">
            <div class="stat-icon">
                <i class="fas fa-file-alt"></i>
                </div>
            <div class="stat-content">
                <h3 class="stat-number">{{ page_obj.number }}</h3>
                <p class="stat-label">Current Page</p>
            </div>
                </div>
        <div class="stat-card total-pages">
            <div class="stat-icon">
                <i class="fas fa-layer-group"></i>
            </div>
            <div class="stat-content">
                <h3 class="stat-number">{{ page_obj.paginator.num_pages }}</h3>
                <p class="stat-label">Total Pages</p>
                </div>
            </div>
        </div>
</div> -->

<!-- Enhanced Table Section -->
<div class="table-section">
    <div class="card enhanced-card">
        <div class="card-header">
        <div class="d-flex align-items-center justify-content-between">
            <h5 class="card-title mb-0">
                    <i class="fas fa-table me-2"></i>Activity List
            </h5>
                <div class="table-controls">
              
            </div>
        </div>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
                <table class="table table-hover mb-0 enhanced-table" id="activityTable">
                    <thead class="table-header">
                    <tr>
                            <th scope="col" class="px-4 py-3">
                                <i class="fas fa-user me-2"></i>User
                        </th>
                            <th scope="col" class="px-4 py-3">
                                <i class="fas fa-tag me-2"></i>Activity Type
                        </th>
                            <th scope="col" class="px-4 py-3">
                                <i class="fas fa-info-circle me-2"></i>Description
                        </th>
                            <th scope="col" class="px-4 py-3">
                                <i class="fas fa-globe me-2"></i>IP Address
                        </th>
                            <th scope="col" class="px-4 py-3">
                                <i class="fas fa-clock me-2"></i>Timestamp
                        </th>
                    </tr>
                </thead>
                <tbody>
                    {% for activity in activities %}
                    <tr class="activity-row" data-activity-id="{{ activity.id }}">
                        <td class="px-4 py-3">
                            <div class="d-flex align-items-center gap-3">
                                    <input type="checkbox" class="form-check-input activity-checkbox me-3" 
                                       data-activity-id="{{ activity.id }}" 
                                       data-user="{{ activity.user.username }}" 
                                       data-email="{{ activity.user.email }}" 
                                       data-type="{{ activity.activity_type }}" 
                                       data-description="{{ activity.description }}" 
                                       data-ip="{{ activity.ip_address }}" 
                                           data-timestamp="{{ activity.created_at|date:'Y-m-d H:i:s' }}">
                                    <div class="user-info">
                                        <div class="user-avatar">
                                            <div class="avatar-circle">
                                                <i class="fas fa-user"></i>
                                            </div>
                                        </div>
                                        <div class="user-details">
                                            <div class="username">{{ activity.user.username }}</div>
                                            <small class="text-muted">{{ activity.user.email }}</small>
                                        </div>
                                    </div>
                            </div>
                        </td>
                        <td class="px-4 py-3">
                            {% if activity.activity_type == 'login' %}
                                    <span class="badge badge-login">Login</span>
                            {% elif activity.activity_type == 'prediction' %}
                                    <span class="badge badge-prediction">Prediction</span>
                            {% elif activity.activity_type == 'report_export' %}
                                    <span class="badge badge-export">Report Export</span>
                            {% elif activity.activity_type == 'settings_change' %}
                                    <span class="badge badge-settings">Settings</span>
                            {% elif activity.activity_type == 'admin_action' %}
                                    <span class="badge badge-admin">AdminAction</span>
                            {% else %}
                                    <span class="badge badge-admin">{{ activity.activity_type|title }}</span>
                            {% endif %}
                        </td>
                        <td class="px-4 py-3">
                                <div class="description-cell">
                                    <span class="description-text">{{ activity.description|truncatechars:50 }}</span>
                                    <button class="btn btn-sm btn-outline-secondary copy-btn" data-description="{{ activity.description }}" title="Copy description">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                            </td>
                        <td class="px-4 py-3">
                                <code class="ip-address">{{ activity.ip_address }}</code>
                        </td>
                        <td class="px-4 py-3">
                                <div class="timestamp-cell">
                                    <div class="date-main">{{ activity.created_at|date:"M d, Y" }}</div>
                                    <small class="text-muted">{{ activity.created_at|date:"H:i:s" }}</small>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                            <td colspan="5" class="text-center py-5">
                                <div class="empty-state">
                                    <div class="empty-icon">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                    <h5 class="empty-title">No activities found</h5>
                                    <p class="empty-text">Try adjusting your filter criteria or check back later.</p>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            </div>
        </div>
    </div>
</div>

<!-- Scrollable Activities List - No Pagination -->
<div class="scrollable-activities-info mt-5">
    <!-- <div class="activities-summary"> -->
        <!-- <i class="fas fa-info-circle me-2"></i> -->
        <!-- <span>Total Activities: <strong>{{ activities.count }}</strong></span> -->
    <!-- </div> -->
    
    <div class="scroll-hint">
        <i class="fas fa-mouse me-2"></i>
        <span>Scroll to see all activities</span>
    </div>
</div>

<style>
/* ========================================
   ENHANCED ACTIVITY LOGS STYLING
   ======================================== */

/* ========================================
   SCROLLABLE ACTIVITIES INFO STYLING
   ======================================== */

.scrollable-activities-info {
    margin-top: 3rem;
    padding: 2rem;
    background: white;
    border-radius: 1rem;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    border: 1px solid #e9ecef;
}

.activities-summary {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 1.5rem;
    padding: 1rem;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 0.75rem;
    border: 1px solid #dee2e6;
}

.activities-summary i {
    color: #667eea;
    font-size: 1.2rem;
}

.activities-summary span {
    color: #495057;
    font-weight: 600;
    font-size: 1.1rem;
    margin-left: 0.5rem;
}

.scroll-hint {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem;
    background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
    border-radius: 0.75rem;
    border: 1px solid #90caf9;
}

.scroll-hint i {
    color: #1976d2;
    font-size: 1.1rem;
}

.scroll-hint span {
    color: #1565c0;
    font-weight: 500;
    font-size: 1rem;
    margin-left: 0.5rem;
}

/* Make table scrollable for many activities */
.table-responsive {
    max-height: 70vh;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: #cbd5e0 #f8f9fa;
}

.table-responsive::-webkit-scrollbar {
    width: 8px;
}

.table-responsive::-webkit-scrollbar-track {
    background: #f8f9fa;
    border-radius: 4px;
}

.table-responsive::-webkit-scrollbar-thumb {
    background: #cbd5e0;
    border-radius: 4px;
}

.table-responsive::-webkit-scrollbar-thumb:hover {
    background: #a0aec0;
}

/* Responsive Design */
@media (max-width: 768px) {
    .scrollable-activities-info {
        padding: 1.5rem;
        margin-top: 2rem;
    }
    
    .activities-summary, .scroll-hint {
        padding: 0.75rem;
    }
    
    .activities-summary span, .scroll-hint span {
        font-size: 0.95rem;
    }
}

@media (max-width: 480px) {
    .scrollable-activities-info {
        padding: 1rem;
    }
    
    .activities-summary, .scroll-hint {
        flex-direction: column;
        text-align: center;
        gap: 0.5rem;
    }
    
    .activities-summary span, .scroll-hint span {
        font-size: 0.9rem;
        margin-left: 0;
    }
}

/* ========================================
   ENHANCED ACTIVITY LOGS STYLING
   ======================================== */

/* Enhanced Header Styling */
.enhanced-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 1rem;
    padding: 2.5rem;
    border: none;
    box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
    margin-bottom: 2rem;
}

.header-icon-wrapper {
    position: relative;
}

.header-icon {
    width: 60px;
    height: 60px;
    background: rgba(255, 255, 255, 0.2);
    color: white;
    border-radius: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.header-text {
    color: white;
}

.header-title {
    font-size: 2.5rem;
    font-weight: 700;
    margin: 0;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.header-subtitle {
    color: rgba(255, 255, 255, 0.9);
    margin: 0.5rem 0 0 0;
    font-size: 1.1rem;
    font-weight: 400;
}

.header-actions {
    display: flex;
    align-items: center;
}

.search-wrapper {
    position: relative;
}

.search-wrapper .input-group {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 0.75rem;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    overflow: hidden;
}

.search-wrapper .input-group-text {
    background: transparent;
    border: none;
    color: white;
    padding: 0.75rem 1rem;
}

.enhanced-input {
    background: rgba(255, 255, 255, 0.95);
    border: none;
    color: #495057;
    padding: 0.75rem 1rem;
    border-radius: 0;
    min-width: 250px;
}

.enhanced-input:focus {
    background: white;
    box-shadow: none;
}

.action-buttons {
    display: flex;
    gap: 0.75rem;
}

.enhanced-btn {
    border-radius: 0.75rem;
    font-weight: 600;
    padding: 0.75rem 1.25rem;
    transition: all 0.3s ease;
    border: 2px solid rgba(255, 255, 255, 0.3);
    background: rgba(255, 255, 255, 0.1);
    color: white;
    backdrop-filter: blur(10px);
}

.enhanced-btn:hover {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.5);
    transform: translateY(-2px);
}

/* Enhanced Filter Section */
.filter-section {
    margin-bottom: 2rem;
}

.filter-description {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border: 1px solid #dee2e6;
    border-radius: 0.75rem;
    padding: 1rem;
    text-align: center;
    font-size: 0.95rem;
}

.filter-description i {
    color: #667eea;
}

.form-text {
    font-size: 0.8rem;
    margin-top: 0.5rem;
    color: #6c757d;
    font-style: italic;
}

/* Form Validation Styling */
.form-control.is-invalid {
    border-color: #dc3545;
    box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
}

.form-control.is-valid {
    border-color: #28a745;
    box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25);
}

.invalid-feedback {
    display: block;
    width: 100%;
    margin-top: 0.25rem;
    font-size: 0.875rem;
    color: #dc3545;
}

.valid-feedback {
    display: block;
    width: 100%;
    margin-top: 0.25rem;
    font-size: 0.875rem;
    color: #28a745;
}

/* Enhanced Form Controls */
.enhanced-input {
    border: 2px solid #e9ecef;
    border-radius: 0.75rem;
    padding: 0.875rem 1rem;
    background: white;
    font-weight: 500;
    transition: all 0.3s ease;
    min-width: 180px;
}

.enhanced-input:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
    transform: translateY(-2px);
}

.enhanced-input:hover {
    border-color: #667eea;
}

/* Enhanced Button Styling */
.enhanced-btn {
    border-radius: 0.75rem;
    font-weight: 600;
    padding: 0.875rem 1.5rem;
    transition: all 0.3s ease;
    border: none;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.enhanced-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
}

.enhanced-btn:active {
    transform: translateY(0);
}

.enhanced-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
}

.enhanced-card {
    border-radius: 1rem;
    border: none;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    overflow: hidden;
}

.enhanced-card .card-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-bottom: none;
    padding: 1.5rem;
}

.enhanced-card .card-title {
    font-size: 1.25rem;
    font-weight: 600;
    margin: 0;
}

.form-group-wrapper {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.form-label {
    color: #495057;
    font-weight: 600;
    font-size: 0.9rem;
    margin: 0;
}

.enhanced-select {
    border: 2px solid #e9ecef;
    border-radius: 0.75rem;
    padding: 0.875rem 1rem;
    background: white;
    font-weight: 500;
    transition: all 0.3s ease;
}

.enhanced-select:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
    transform: translateY(-2px);
}

.filter-actions {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.filter-label {
    font-weight: 600;
    color: #495057;
    font-size: 0.9rem;
    
}

.quick-filters {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.quick-filters .btn-group .btn {
    border-radius: 0.5rem;
    font-weight: 500;
    padding: 0.5rem 1rem;
    border: 2px solid #667eea;
    color: #667eea;
    background: white;
}

.quick-filters .btn-group .btn:hover {
    background: #667eea;
    color: white;
    transform: translateY(-1px);
}

.active-filters {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    flex-wrap: wrap;
}

.filter-badge {
    display: inline-flex;
    align-items: center;
    padding: 0.5rem 0.75rem;
    background: #e9ecef;
    border-radius: 2rem;
    font-size: 0.8rem;
    font-weight: 500;
    color: #495057;
    border: 1px solid #dee2e6;
}

.filter-badge.clear-all {
    background: #dc3545;
    color: white;
    border-color: #dc3545;
}

.remove-filter {
    margin-left: 0.5rem;
    color: inherit;
    text-decoration: none;
    font-weight: bold;
    padding: 0 0.25rem;
    border-radius: 50%;
    transition: all 0.2s ease;
}

.remove-filter:hover {
    background: rgba(0, 0, 0, 0.1);
    color: inherit;
}

/* Enhanced Stats Cards */
.stats-section {
    margin-bottom: 2rem;
}

.stat-card {
    background: white;
    border-radius: 1rem;
    padding: 1.5rem;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    border: 1px solid #f8f9fa;
    transition: all 0.3s ease;
    height: 100%;
    display: flex;
    align-items: center;
    gap: 1rem;
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
}

.stat-icon {
    width: 60px;
    height: 60px;
    border-radius: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: white;
}

.total-activities .stat-icon { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
.showing-activities .stat-icon { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
.current-page .stat-icon { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
.total-pages .stat-icon { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }

.stat-content {
    flex: 1;
}

.stat-number {
    font-size: 2rem;
    font-weight: 700;
    margin: 0;
    color: #2d3748;
}

.stat-label {
    color: #718096;
    margin: 0;
    font-weight: 500;
    font-size: 0.9rem;
}

/* Enhanced Table Section */
.table-section {
    margin-bottom: 2rem;
}

.table-header {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
}

.table-header th {
    font-weight: 600;
    color: #495057;
    border-bottom: 2px solid #dee2e6;
    padding: 1.25rem 1.5rem;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.enhanced-table tbody tr {
    transition: all 0.2s ease;
}

.enhanced-table tbody tr:hover {
    background-color: #f8f9fa;
    transform: scale(1.001);
}

.enhanced-table td {
    padding: 1.25rem 1.5rem;
    vertical-align: middle;
    border-bottom: 1px solid #f8f9fa;
}

/* User Row Styling */
.user-avatar {
    display: flex;
    align-items: center;
}

.avatar-circle {
    width: 45px;
    height: 45px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
}

.user-info {
    display: flex;
    flex-direction: column;
}

.username {
    font-weight: 600;
    color: #2d3748;
    font-size: 1rem;
}

/* Enhanced Badge Styling */
.badge {
    padding: 0.5rem 1rem;
    border-radius: 2rem;
    font-weight: 600;
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.badge-login { background: linear-gradient(135deg, #51cf66 0%, #40c057 100%); color: white; }
.badge-prediction { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; }
.badge-export { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; }
.badge-settings { background: linear-gradient(135deg, #ffd43b 0%, #fcc419 100%); color: #495057; }
.badge-admin { background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%); color: white; }
.badge-default { background: linear-gradient(135deg, #6c757d 0%, #495057 100%); color: white; }

/* Description Cell */
.description-cell {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.description-text {
    flex: 1;
    color: #4a5568;
}

.copy-btn {
    width: 32px;
    height: 32px;
    border-radius: 0.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    border: 2px solid #e9ecef;
    transition: all 0.2s ease;
}

.copy-btn:hover {
    background: #667eea;
    border-color: #667eea;
    color: white;
    transform: translateY(-1px);
}

/* IP Address */
.ip-address {
    background: #f8f9fa;
    color: #6c757d;
    padding: 0.25rem 0.5rem;
    border-radius: 0.375rem;
    font-size: 0.875rem;
    font-weight: 500;
    border: 1px solid #e9ecef;
}

/* Timestamp Cell */
.timestamp-cell {
    display: flex;
    flex-direction: column;
}

.date-main {
    font-weight: 600;
    color: #2d3748;
}

/* Action Buttons */
.action-buttons {
    display: flex;
    gap: 0.5rem;
    justify-content: flex-end;
}

.action-btn {
    width: 36px;
    height: 36px;
    border-radius: 0.75rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    border: 2px solid;
    padding: 0;
}

.action-btn:hover {
    transform: translateY(-2px);
}

/* Empty State */
.empty-state {
    text-align: center;
    padding: 3rem 1rem;
}

.empty-icon {
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 1.5rem;
    font-size: 2rem;
    color: #6c757d;
}

.empty-title {
    color: #495057;
    margin-bottom: 0.5rem;
    font-weight: 600;
}

.empty-text {
    color: #6c757d;
    margin: 0;
}

/* Enhanced Pagination */
.pagination-section {
    background: white;
    padding: 1.5rem;
    border-radius: 1rem;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    border: 1px solid #f8f9fa;
}



/* Table Controls */
.table-controls {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.control-label {
    font-size: 0.9rem;
    color: #6c757d;
    font-weight: 500;
}

.form-check {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.form-check-input {
    width: 1.2rem;
    height: 1.2rem;
    border-radius: 0.375rem;
}

/* Responsive Design */
@media (max-width: 768px) {
    .enhanced-header {
        padding: 1.5rem;
    }
    
    .header-title {
        font-size: 2rem;
    }
    
    .search-wrapper .enhanced-input {
        min-width: 200px;
    }
    
    .action-buttons {
        flex-direction: column;
        gap: 0.5rem;
        justify-content: flex-start;
    }
    
    .filter-actions {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
    }
    
    .quick-filters {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
    }
    
    .stat-card {
        padding: 1rem;
    }
    
    .stat-number {
        font-size: 1.5rem;
    }
    
    .enhanced-table td, .enhanced-table th {
        padding: 1rem;
    }
}

/* Smooth Animations */
* {
    transition: all 0.2s ease;
}

/* Focus States */
.enhanced-input:focus, .enhanced-select:focus, .enhanced-btn:focus {
    outline: none;
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
}

/* Admin Select Dropdown Styling */
.admin-select {
    background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
    border: 2px solid #ff6b6b;
    border-radius: 0.75rem;
    color: black;
    font-weight: 600;
    padding: 0.875rem 1rem;
    transition: all 0.3s ease;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
}

.admin-select:hover {
    background: linear-gradient(135deg, #ff5252 0%, #e64a19 100%);
    border-color: #ff5252;
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
    color: black;
}

.admin-select:focus {
    background: linear-gradient(135deg, #ff5252 0%, #e64a19 100%);
    border-color: #ff5252;
    box-shadow: 0 0 0 0.2rem rgba(255, 107, 107, 0.25);
    transform: translateY(-2px);
    color: black;
}

.admin-select option {
    background: white;
    color: black;
    font-weight: 500;
    padding: 0.5rem;
}

.admin-select option:hover {
    background: #f8f9fa;
    color: black;
}

/* Custom dropdown arrow - changed to black for better visibility */
.admin-select {
    appearance: none;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23000000' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 0.75rem center;
    background-size: 1.5em;
    padding-right: 2.5rem;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // ========================================
    // DOM ELEMENTS
    // ========================================
    const filterForm = document.getElementById('filterForm');
    const dateFrom = document.getElementById('date_from');
    const dateTo = document.getElementById('date_to');
    const activityType = document.getElementById('activity_type');
    const applyFiltersBtn = document.getElementById('applyFiltersBtn');
    const selectAllLogs = document.getElementById('selectAllLogs');
    const activityCheckboxes = document.querySelectorAll('.activity-checkbox');
    const copyButtons = document.querySelectorAll('.copy-btn');
    
    // ========================================
    // DATE VALIDATION & FILTERING
    // ========================================
    
    // Set max date to today for both date inputs
    const today = new Date().toISOString().split('T')[0];
    if (dateFrom) dateFrom.max = today;
    if (dateTo) dateTo.max = today;
    
    // Date validation function
    function validateDates() {
        let isValid = true;
        
        // Clear previous validation states
        dateFrom.classList.remove('is-invalid', 'is-valid');
        dateTo.classList.remove('is-invalid', 'is-valid');
        document.getElementById('date_from_error').textContent = '';
        document.getElementById('date_to_error').textContent = '';
        
        const fromDate = dateFrom.value;
        const toDate = dateTo.value;
        
        // Check if both dates are provided
        if (fromDate && toDate) {
            if (fromDate > toDate) {
                dateFrom.classList.add('is-invalid');
                dateTo.classList.add('is-invalid');
                document.getElementById('date_from_error').textContent = 'Start date cannot be after end date';
                document.getElementById('date_to_error').textContent = 'End date cannot be before start date';
                isValid = false;
            } else {
                dateFrom.classList.add('is-valid');
                dateTo.classList.add('is-valid');
            }
        } else if (fromDate || toDate) {
            // If only one date is provided, mark it as valid
            if (fromDate) dateFrom.classList.add('is-valid');
            if (toDate) dateTo.classList.add('is-valid');
        }
        
        return isValid;
    }
    
    // Add validation on date input change
    if (dateFrom) {
        dateFrom.addEventListener('change', validateDates);
    }
    if (dateTo) {
        dateTo.addEventListener('change', validateDates);
    }
    
    // ========================================
    // FORM SUBMISSION & VALIDATION
    // ========================================
    
    if (filterForm) {
        filterForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (validateDates()) {
                // Build query parameters
                const params = new URLSearchParams();
                
                if (activityType.value) {
                    params.append('activity_type', activityType.value);
                }
                if (dateFrom.value) {
                    params.append('date_from', dateFrom.value);
                }
                if (dateTo.value) {
                    params.append('date_to', dateTo.value);
                }
                
                // Redirect with filters
                const url = window.location.pathname + (params.toString() ? '?' + params.toString() : '');
                window.location.href = url;
            } else {
                // Show error message
                showNotification('Please fix the date validation errors before applying filters.', 'error');
            }
        });
    }
    
    // ========================================
    // QUICK DATE FILTERS
    // ========================================
    
  
    // Insert quick filters after the form
    if (filterForm) {
        filterForm.parentNode.insertBefore(quickFiltersContainer, filterForm.nextSibling);
    }
    
    // Quick filter functionality
    quickFiltersContainer.addEventListener('click', function(e) {
        const btn = e.target.closest('button[data-range]');
        if (!btn) return;
        
        const range = btn.getAttribute('data-range');
        const today = new Date();
        const pad = n => String(n).padStart(2, '0');
        const toStr = d => `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
        
        let fromDate, toDate;
        
        if (range === 'today') {
            fromDate = toDate = toStr(today);
        } else {
            const days = parseInt(range, 10);
            toDate = toStr(today);
            const from = new Date(today);
            from.setDate(from.getDate() - (days - 1));
            fromDate = toStr(from);
        }
        
        // Set the date inputs
        if (dateFrom) dateFrom.value = fromDate;
        if (dateTo) dateTo.value = toDate;
        
        // Validate and submit
        if (validateDates()) {
            filterForm.submit();
        }
    });
    
    // ========================================
    // UTILITY FUNCTIONS
    // ========================================
    
    function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `alert alert-${type === 'error' ? 'danger' : type} alert-dismissible fade show position-fixed`;
        notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
        notification.innerHTML = `
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.remove();
        }, 5000);
    }

    // Client-side search
    if (clientSearch) {
        clientSearch.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const rows = document.querySelectorAll('.activity-row');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });
    }

    // Select all functionality
    if (selectAllLogs) {
        selectAllLogs.addEventListener('change', () => {
            activityCheckboxes.forEach(cb => {
                cb.checked = selectAllLogs.checked;
            });
        });
    }

    // Individual checkbox handling
    activityCheckboxes.forEach(cb => {
        cb.addEventListener('change', () => {
            const allChecked = Array.from(activityCheckboxes).every(cb => cb.checked);
            if (selectAllLogs) selectAllLogs.checked = allChecked;
        });
    });

    // Export functionality
    if (exportLogsBtn) {
        exportLogsBtn.addEventListener('click', () => {
            const selected = Array.from(activityCheckboxes).filter(cb => cb.checked);
            const source = (selected.length ? selected : Array.from(activityCheckboxes));
            
            const headers = ['id','user','email','activity_type','description','ip_address','timestamp'];
            const csv = [headers.join(',')].concat(source.map(cb => {
                const vals = [
                    cb.dataset.activityId,
                    cb.dataset.user,
                    cb.dataset.email,
                    cb.dataset.type,
                    cb.dataset.description,
                    cb.dataset.ip,
                    cb.dataset.timestamp
                ];
                return vals.map(v => '"' + String(v ?? '').replaceAll('"', '""') + '"').join(',');
            })).join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'activity_logs.csv';
            a.click();
            URL.revokeObjectURL(url);
        });
    }

    // Copy description functionality
    copyButtons.forEach(btn => {
        btn.addEventListener('click', () => {
            const description = btn.dataset.description;
            navigator.clipboard.writeText(description).then(() => {
                const originalHTML = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-check"></i>';
                btn.classList.remove('btn-outline-secondary');
                btn.classList.add('btn-success');
                
                setTimeout(() => {
                    btn.innerHTML = originalHTML;
                    btn.classList.remove('btn-success');
                    btn.classList.add('btn-outline-secondary');
                }, 2000);
            });
        });
    });

    // Quick date presets
    if (quickRange) {
        quickRange.addEventListener('click', (e) => {
            const btn = e.target.closest('button[data-range]');
            if (!btn) return;
            
            const range = btn.getAttribute('data-range');
            const params = new URLSearchParams(window.location.search);
            const today = new Date();
            const pad = n => String(n).padStart(2,'0');
            const toStr = d => `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
            const to = toStr(today);
            let from = to;
            
            if (range !== 'today') {
                const days = parseInt(range, 10);
                const d = new Date(today);
                d.setDate(d.getDate() - (days - 1));
                from = toStr(d);
            }
            
            params.set('date_from', from);
            params.set('date_to', to);
            window.location.search = params.toString();
        });
    }
});
</script>
{% endblock %}

