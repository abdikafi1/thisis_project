<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Fraud Detector Dashboard{% endblock %}</title>
    <!-- TailwindCSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* Mobile-first responsive design */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: #f8f9fa;
            overflow-x: hidden;
            font-size: 14px; /* Mobile default */
        }
        
        /* Tablet (768px+) */
        @media (min-width: 768px) {
            body {
                font-size: 16px;
            }
        }
        
        /* Desktop (1024px+) */
        @media (min-width: 1024px) {
            body {
                font-size: 18px;
            }
        }
        
        /* Ensure images scale down on small screens */
        img {
            max-width: 100%;
            height: auto;
            display: block;
        }
        
        /* Prevent horizontal scrolling */
        .main-content {
            max-width: 100vw;
            overflow-x: hidden;
        }
        
        .sidebar {
            transition: transform 0.3s ease-in-out;
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
            z-index: 50;
        }
        
        .sidebar.collapsed {
            transform: translateX(-100%);
        }
        
        .main-content {
            transition: margin-left 0.3s ease-in-out;
            width: 100%;
        }
        
        .main-content.expanded {
            margin-left: 0;
        }
        
        /* Mobile-first sidebar behavior */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                transform: translateX(-100%);
                width: 280px;
                max-width: 90vw;
            }
            
            .sidebar.mobile-open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
                width: 100%;
            }
            
            /* Mobile overlay */
            .sidebar-overlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.5);
                z-index: 40;
                opacity: 0;
                visibility: hidden;
                transition: all 0.3s ease;
            }
            
            .sidebar-overlay.active {
                opacity: 1;
                visibility: visible;
            }
        }
        
        /* Desktop sidebar behavior */
        @media (min-width: 769px) {
            .sidebar {
                position: fixed;
                transform: translateX(0);
                width: 256px;
            }
            
            .main-content {
                margin-left: 256px;
            }
            
            .sidebar.collapsed {
                transform: translateX(-100%);
            }
            
            .main-content.expanded {
                margin-left: 0;
            }
        }
        
        .sidebar-item {
            transition: all 0.3s ease;
            border-radius: 12px;
            margin: 4px 8px;
            position: relative;
            overflow: hidden;
        }
        
        .sidebar-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }
        
        .sidebar-item:hover::before {
            left: 100%;
        }
        
        .sidebar-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(6px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            color: white !important;
        }
        
        .sidebar-item:hover:not(.active) {
            background: rgba(255, 255, 255, 0.18);
            transform: translateX(4px);
        }
        
        /* Ensure all sidebar items have consistent hover effects */
        .sidebar-item:hover .nav-text,
        .sidebar-item:hover .nav-icon {
            color: white !important;
            transform: scale(1.05);
        }
        
        .sidebar-item:hover .nav-icon {
            transform: scale(1.1) rotate(5deg);
        }
        
        .sidebar-item.active {
            background: rgba(255, 255, 255, 0.25);
            border-right: 4px solid #ffffff;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            transform: translateX(8px);
            color: #ffffff !important;
        }
        
        .sidebar-item.active::before {
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.1), transparent);
        }
        
        .sidebar-item.active::after {
            content: '';
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid #ffffff;
            border-top: 8px solid transparent;
            border-bottom: 8px solid transparent;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
        }
        
        .sidebar-item.active .nav-icon,
        .sidebar-item.active .nav-text {
            color: #ffffff !important;
            font-weight: 600;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* User Profile Dropdown Styles */
        #user-dropdown-menu {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            transform-origin: top right;
        }
        
        #user-dropdown-menu.visible {
            opacity: 1;
            visibility: visible;
            transform: scale(1);
        }
        
        #user-dropdown-menu:not(.visible) {
            opacity: 0;
            visibility: hidden;
            transform: scale(0.95);
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        
        .user-avatar:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }
        
        #user-avatar-btn .fa-chevron-down {
            transition: transform 0.2s ease;
        }
        
        /* Dropdown menu items hover effects */
        #user-dropdown-menu a:hover {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            transform: translateX(4px);
        }
        
        #user-dropdown-menu a {
            transition: all 0.2s ease;
        }
        
        /* Analytics Overview Styling */
        .sidebar-section {
            margin-top: 1.5rem;
        }
        
        .nav-section-title {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .bg-white\/10 {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .backdrop-blur-sm {
            backdrop-filter: blur(4px);
        }
        
        .text-white\/80 {
            color: rgba(255, 255, 255, 0.8);
        }
        
        .text-white\/10 {
            color: rgba(255, 255, 255, 0.1);
        }
        
        .sidebar-header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .nav-section-title {
            color: rgba(255, 255, 255, 0.75);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            font-size: 0.75rem;
            padding-bottom: 6px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
        }
        .sidebar-section { margin-bottom: 1rem; }
        .sidebar-section + .sidebar-section { margin-top: 1.25rem; }
        
        .nav-icon {
            width: 20px;
            margin-right: 12px;
            text-align: center;
            font-size: 1.1rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .nav-text {
            font-weight: 500;
            color: white;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .sidebar-footer {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-weight: 600;
            color: white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .user-name {
            font-weight: 600;
            color: white;
            font-size: 0.9rem;
        }
        
        .user-role {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .logout-btn {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: 12px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .top-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        }
        
        .page-title {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        /* Mobile responsive page title */
        @media (max-width: 768px) {
            .page-title {
                font-size: 1.5rem;
            }
        }
        
        .notification-bell {
            position: relative;
            font-size: 1.3rem;
            color: #667eea;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .notification-bell:hover {
            transform: scale(1.1);
        }
        
        .notification-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3);
        }
        
        /* Page title animation */
        .page-title.animate {
            animation: titleSlideIn 0.6s ease-out;
        }
        
        @keyframes titleSlideIn {
            0% {
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        /* Welcome Message Styling */
        .welcome-message {
            animation: welcomeSlideIn 0.8s ease-out;
        }
        
        .welcome-message p {
            transition: all 0.3s ease;
        }
        
        .welcome-message:hover p {
            transform: translateX(5px);
        }
        
        .welcome-message .fas {
            animation: wave 2s infinite;
        }
        
        @keyframes welcomeSlideIn {
            0% {
                opacity: 0;
                transform: translateX(-30px);
            }
            100% {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes wave {
            0%, 20%, 50%, 80%, 100% {
                transform: rotate(0deg);
            }
            10%, 30% {
                transform: rotate(14deg);
            }
            40%, 60% {
                transform: rotate(-8deg);
            }
            70% {
                transform: rotate(14deg);
            }
        }
        
        /* Mobile responsive adjustments */
        @media (max-width: 768px) {
            .top-header {
                padding: 1rem;
            }
            
            .top-header .flex {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .top-header .flex > div:last-child {
                align-self: stretch;
                justify-content: space-between;
            }
            
            .page-title {
                font-size: 1.5rem;
                line-height: 2rem;
            }
            
            .text-gray-500 {
                font-size: 0.875rem;
            }
        }
        
        /* Ensure content doesn't overflow on mobile */
        .glass-effect {
            max-width: 100%;
            overflow-x: hidden;
        }
        
        /* Mobile responsive sidebar toggle */
        @media (max-width: 768px) {
            #sidebar-toggle {
                position: fixed;
                top: 1rem;
                left: 1rem;
                z-index: 60;
                background: white;
                border: 1px solid #e5e7eb;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            }
        }
        
        /* Mobile Header Styling */
        .mobile-header {
            padding: 1rem !important;
        }
        
        .mobile-header .flex {
            flex-direction: column;
            align-items: flex-start;
            gap: 1rem;
        }
        
        .mobile-header .flex > div:last-child {
            align-self: stretch;
            justify-content: space-between;
        }
        
        .mobile-header .page-title {
            font-size: 1.5rem !important;
            line-height: 2rem !important;
        }
        
        .mobile-header .text-gray-500 {
            font-size: 0.875rem !important;
        }
        
        .mobile-menu-btn {
            position: fixed !important;
            top: 1rem !important;
            left: 1rem !important;
            z-index: 60 !important;
            background: white !important;
            border: 1px solid #e5e7eb !important;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1) !important;
            display: block !important;
        }
        
        /* Desktop Header Styling */
        .top-header:not(.mobile-header) {
            padding: 1.5rem 1.5rem !important;
        }
        
        .top-header:not(.mobile-header) .flex {
            flex-direction: row;
            align-items: center;
            gap: 0;
        }
        
        .top-header:not(.mobile-header) .page-title {
            font-size: 1.8rem !important;
            line-height: 2.25rem !important;
        }
        
        .top-header:not(.mobile-header) .text-gray-500 {
            font-size: 1rem !important;
        }
        
        /* PC Containment Styles */
        .pc-container {
            max-width: 1366px;
            margin: 0 auto;
            min-height: 768px;
            overflow: hidden;
        }
        
        /* Responsive adjustments for PC container */
        @media (max-width: 1366px) {
            .pc-container {
                max-width: 100%;
                margin: 0 1rem;
            }
        }
        
        @media (max-width: 768px) {
            .pc-container {
                margin: 0 0.5rem;
                min-height: auto;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Mobile Sidebar Overlay -->
    <div id="sidebar-overlay" class="sidebar-overlay" onclick="toggleMobileSidebar()"></div>
    
    <!-- Sidebar -->
    <div id="sidebar" class="sidebar fixed left-0 top-0 h-full w-64 bg-gradient-to-b from-gray-900 via-gray-800 to-gray-900 text-white shadow-lg z-50">
        <!-- Sidebar Header -->
        <div class="sidebar-header text-white p-6">
            <div class="flex items-center justify-between">
                <h1 class="text-xl font-bold flex items-center">
                    <i class="fas fa-shield-alt mr-3 text-2xl"></i>
                    FraudGuard
                </h1>
                <!-- Mobile close button -->
                <button class="lg:hidden w-8 h-8 bg-red-500/20 hover:bg-red-500/30 text-red-300 hover:text-red-200 rounded-lg flex items-center justify-center transition-colors" onclick="toggleMobileSidebar()">
                    <i class="fas fa-times text-sm"></i>
                </button>
            </div>
            {% if user.is_authenticated %}
            <div class="mt-3 text-sm opacity-90">
                <i class="fas fa-user mr-2"></i>
                {{ user.first_name|default:user.username }}
            </div>
            {% endif %}
        </div>

        <!-- Sidebar Navigation -->
        <nav class="mt-6 flex-1 px-4" role="navigation" aria-label="User Sidebar Navigation">
            <div class="sidebar-section">
                <h3 class="nav-section-title px-4 py-2">Main Navigation</h3>
            </div>
            
            <ul class="space-y-1.5">
                <li>
                    <a href="{% url 'home' %}" {% if request.resolver_match.url_name == 'home' %}aria-current="page"{% endif %} class="sidebar-item flex items-center px-4 py-3 text-white hover:text-white {% if request.resolver_match.url_name == 'home' %}active{% endif %}">
                        <i class="fas fa-home nav-icon"></i>
                        <span class="nav-text">Home</span>
                    </a>
                </li>
                <li>
                    <a href="{% url 'dashboard' %}" {% if request.resolver_match.url_name == 'dashboard' or request.resolver_match.url_name == 'user_reports' %}aria-current="page"{% endif %} class="sidebar-item flex items-center px-4 py-3 text-white hover:text-white {% if request.resolver_match.url_name == 'dashboard' or request.resolver_match.url_name == 'user_reports' %}active{% endif %}">
                        <i class="fas fa-tachometer-alt nav-icon"></i>
                        <span class="nav-text">Dashboard</span>
                    </a>
                </li>
                <li>
                    <a href="{% url 'predict' %}" {% if request.resolver_match.url_name == 'predict' %}aria-current="page"{% endif %} class="sidebar-item flex items-center px-4 py-3 text-white hover:text-white {% if request.resolver_match.url_name == 'predict' %}active{% endif %}">
                        <i class="fas fa-search nav-icon"></i>
                        <span class="nav-text">Analyze New claim</span>
                    </a>
                </li>

            </ul>

         
            
            <!-- Reports Section -->
            <div class="sidebar-section">
                <h3 class="nav-section-title px-4 py-2">Reports</h3>
            </div>
            
            <ul class="space-y-1.5 mt-7 mb-5">
                <li>
                    <a href="{% url 'user_reports' %}" {% if request.resolver_match.url_name == 'user_reports' %}aria-current="page"{% endif %} class="sidebar-item flex items-center px-4 py-3 text-white hover:text-white {% if request.resolver_match.url_name == 'user_reports' %}active{% endif %}">
                        <i class="fas fa-chart-bar nav-icon"></i>
                        <span class="nav-text">Reports</span>
                    </a>
                </li>
                
            </ul>

    
           

            <!-- Settings Section removed per request; controls moved to top header icons -->
        </nav>

        <!-- Sidebar Footer -->
        <div class="sidebar-footer p-4">
            {% if user.is_authenticated %}
                <div class="flex items-center justify-center mb-4">
                    <a href="{% url 'unified_profile' %}" class="user-avatar hover:scale-110 transition-transform duration-200 cursor-pointer" title="View User Profile">
                        {{ user.first_name|first|default:user.username|first|upper }}
                    </a>
                </div>
                <!-- Logout Button in Sidebar -->
                <a href="{% url 'logout' %}" class="logout-btn flex items-center justify-center w-full bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors duration-200 hover:scale-105">
                    <i class="fas fa-sign-out-alt mr-2"></i>
                    Logout
                </a>
            {% else %}
                <div class="flex items-center justify-center mb-4">
                    <a href="{% url 'login' %}" class="user-avatar hover:scale-110 transition-transform duration-200 cursor-pointer" title="Login">
                        <i class="fas fa-user"></i>
                    </a>
                </div>
                <a href="{% url 'login' %}" class="logout-btn flex items-center justify-center">
                    <i class="fas fa-sign-in-alt mr-2"></i>
                    Login
                </a>
            {% endif %}
        </div>
    </div>

    <!-- Main Content -->
    <div id="main-content" class="main-content ml-64">
        <!-- Top Header -->
        <header class="top-header px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                                <div class="flex items-center space-x-3">
                <button id="sidebar-toggle" class="text-gray-600 hover:text-gray-900 transition-all duration-300 p-2 rounded-lg hover:bg-gray-100 border border-gray-200 hover:border-gray-300 shadow-sm" title="Toggle Sidebar">
                    <i class="fas fa-bars text-lg"></i>
                </button>
                <div class="flex flex-col">
                    <!-- Welcome Message -->
                   
                    
                                    <h1 class="page-title" id="dynamic-page-title">Dashboard</h1>
                <p class="text-gray-500 mt-1 flex items-center text-sm">
                    <i class="fas fa-shield-alt text-blue-500 mr-2"></i>
                    <span id="dynamic-page-description">Your fraud detection dashboard</span>
                </p>
                </div>
            </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    {% if user.is_authenticated %}
                        <div class="flex items-center space-x-3">
                            <a href="{% url 'unified_profile' %}" class="flex items-center space-x-3 text-gray-700 hover:text-gray-900 transition-colors group" title="View Profile">
                                <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white text-sm font-semibold shadow-lg hover:scale-110 transition-transform duration-200 cursor-pointer group-hover:shadow-xl">
                                    {{ user.first_name|first|default:user.username|first|upper }}
                                </div>
                                <span class="hidden md:block font-medium group-hover:text-blue-600">{{ user.first_name|default:user.username }}</span>
                            </a>
                            
                            <!-- Quick Actions -->
                            <div class="flex items-center space-x-2">
                                <!-- <a href="{% url 'user_settings' %}" class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors" title="Settings">
                                    <i class="fas fa-cog text-lg"></i>
                                </a> -->
                                <!-- Logout Button -->
                                <a href="{% url 'logout' %}" class="p-2 text-red-500 hover:text-red-600 hover:bg-red-100 rounded-lg transition-colors" title="Logout">
                                    <i class="fas fa-sign-out-alt text-lg"></i>
                                </a>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </header>

        <!-- Page Content -->
        <main class="p-6 glass-effect rounded-2xl shadow-lg mt-6 mx-4">
            <!-- PC Containment Wrapper -->
            <div class="pc-container">
                {% if messages %}
                {% for message in messages %}
                    <div class="message-auto-hide mb-4 p-4 rounded-lg {% if message.tags == 'error' %}bg-red-100 text-red-700 border border-red-200{% elif message.tags == 'success' %}bg-green-100 text-green-700 border border-green-200{% else %}bg-blue-100 text-blue-700 border border-blue-200{% endif %} shadow-sm transition-all duration-500" data-message-id="{{ forloop.counter }}">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <i class="fas {% if message.tags == 'error' %}fa-exclamation-circle{% elif message.tags == 'success' %}fa-check-circle{% else %}fa-info-circle{% endif %} mr-2 text-sm"></i>
                                <span>{{ message }}</span>
                            </div>
                            <button class="message-close-btn ml-3 text-gray-400 hover:text-gray-600 transition-colors" onclick="hideMessage(this.parentElement)">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                {% endfor %}
                {% endif %}
                
                {% block content %}{% endblock %}
            </div>
        </main>
    </div>



    </div>

    <script>
        // Mobile Header Implementation Logic
        let isMobileHeader = false;
        let currentScreenWidth = window.innerWidth;
        
        // Function to check if screen width is mobile
        function isMobileScreen() {
            return window.innerWidth < 768;
        }
        
        // Function to show mobile header
        function showMobileHeader() {
            if (!isMobileHeader) {
                console.log('📱 Switching to Mobile Header');
                isMobileHeader = true;
                
                // Update header layout for mobile
                const topHeader = document.querySelector('.top-header');
                if (topHeader) {
                    topHeader.classList.add('mobile-header');
                }
                
                // Ensure mobile menu button is visible
                const sidebarToggle = document.getElementById('sidebar-toggle');
                if (sidebarToggle) {
                    sidebarToggle.classList.add('mobile-menu-btn');
                    sidebarToggle.classList.remove('hidden');
                }
            }
        }
        
        // Function to show desktop header
        function showDesktopHeader() {
            if (isMobileHeader) {
                console.log('🖥️ Switching to Desktop Header');
                isMobileHeader = false;
                
                // Update header layout for desktop
                const topHeader = document.querySelector('.top-header');
                if (topHeader) {
                    topHeader.classList.remove('mobile-header');
                }
                
                // Ensure mobile menu button is hidden on desktop
                const sidebarToggle = document.getElementById('sidebar-toggle');
                if (sidebarToggle) {
                    sidebarToggle.classList.remove('mobile-menu-btn');
                }
            }
        }
        
        // Function to update header based on screen width
        function updateHeaderForScreenSize() {
            const newScreenWidth = window.innerWidth;
            
            if (newScreenWidth !== currentScreenWidth) {
                currentScreenWidth = newScreenWidth;
                
                if (isMobileScreen()) {
                    showMobileHeader();
                } else {
                    showDesktopHeader();
                }
            }
        }
        
        // Mobile sidebar toggle functionality
        function toggleMobileSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            
            if (sidebar.classList.contains('mobile-open')) {
                sidebar.classList.remove('mobile-open');
                overlay.classList.remove('active');
            } else {
                sidebar.classList.add('mobile-open');
                overlay.classList.add('active');
            }
        }
        
        // Desktop sidebar toggle functionality
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('main-content');
        const sidebarToggle = document.getElementById('sidebar-toggle');

        function updateToggleVisibility() {
            // Function simplified - no dashboard indicator needed
        }

        function toggleSidebar() {
            if (window.innerWidth > 768) {
                // Desktop behavior
                sidebar.classList.toggle('collapsed');
                mainContent.classList.toggle('expanded');
            } else {
                // Mobile behavior
                toggleMobileSidebar();
            }
            updateToggleVisibility();
        }

        // Event listeners
        if (sidebarToggle) {
            sidebarToggle.addEventListener('click', toggleSidebar);
        }

        // Close mobile sidebar when clicking outside
        document.addEventListener('click', function(event) {
            if (window.innerWidth <= 768) {
                const sidebar = document.getElementById('sidebar');
                const sidebarToggle = document.getElementById('sidebar-toggle');
                
                if (!sidebar.contains(event.target) && !sidebarToggle.contains(event.target)) {
                    sidebar.classList.remove('mobile-open');
                    document.getElementById('sidebar-overlay').classList.remove('active');
                }
            }
        });

        // Handle window resize
        window.addEventListener('resize', function() {
            updateHeaderForScreenSize(); // Call the new function
            if (window.innerWidth > 768) {
                sidebar.classList.remove('mobile-open');
                document.getElementById('sidebar-overlay').classList.remove('active');
            }
        });
        
        // Initialize mobile header logic on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize header based on current screen size
            if (isMobileScreen()) {
                showMobileHeader();
            } else {
                showDesktopHeader();
            }
            
            updateToggleVisibility();
            
            // Set initial page title based on active sidebar item
            const activeItem = document.querySelector('.sidebar-item.active');
            if (activeItem) {
                const navText = activeItem.querySelector('.nav-text');
                if (navText) {
                    const pageTitleElement = document.getElementById('dynamic-page-title');
                    const pageDescriptionElement = document.getElementById('dynamic-page-description');
                    if (pageTitleElement && pageDescriptionElement) {
                        pageTitleElement.textContent = navText.textContent;
                        updatePageDescription(navText.textContent);
                    }
                }
            }
            
            // Enhanced URL-based header update
            const currentPath = window.location.pathname;
            if (currentPath.includes('dashboard')) {
                updateHeaderTitle('Dashboard');
            } else if (currentPath.includes('profile')) {
                updateHeaderTitle('Profile');
            } else if (currentPath.includes('predict')) {
                updateHeaderTitle('Analyze New claim');
            } else if (currentPath.includes('reports')) {
                updateHeaderTitle('Reports');
            } else if (currentPath.includes('home') || currentPath === '/') {
                updateHeaderTitle('Home');
            }
            
            // Update header based on current active sidebar item
            const currentActiveItem = document.querySelector('.sidebar-item.active');
            if (currentActiveItem) {
                updateUserHeaderFromSidebar();
            }
        });
        
        // Enhanced function to update page description based on page title
        function updatePageDescription(pageTitle) {
            const pageDescriptionElement = document.getElementById('dynamic-page-description');
            if (!pageDescriptionElement) return;
            
            // Enhanced descriptions for each page
            const descriptions = {
                'Home': 'Welcome to your fraud detection system',
                'Dashboard': 'Your fraud detection dashboard and overview',
                'Analyze New claim': 'Analyze new insurance claims for fraud detection',
                'Reports': 'View and export fraud detection reports',
                'Profile': 'Manage your user profile and settings'
            };
            
            const newDescription = descriptions[pageTitle] || 'Your fraud detection system';
            pageDescriptionElement.textContent = newDescription;
        }
        
        // Function to update header title
        function updateHeaderTitle(newTitle) {
            const pageTitleElement = document.getElementById('dynamic-page-title');
            const pageDescriptionElement = document.getElementById('dynamic-page-description');
            if (!pageTitleElement || !pageDescriptionElement) return;
            
            const currentTitle = pageTitleElement.textContent;
            
            if (newTitle !== currentTitle) {
                // Add animation class
                pageTitleElement.classList.add('animate');
                
                // Update title with a slight delay for smooth animation
                setTimeout(() => {
                    pageTitleElement.textContent = newTitle;
                    
                    // Update description based on the page
                    updatePageDescription(newTitle);
                }, 200);
                
                // Remove animation class after animation completes
                setTimeout(() => {
                    pageTitleElement.classList.remove('animate');
                }, 600);
            }
        }
        
        // Add smooth animations to sidebar items
        document.addEventListener('DOMContentLoaded', function() {
            const sidebarItems = document.querySelectorAll('.sidebar-item');
            sidebarItems.forEach((item, index) => {
                item.style.opacity = '0';
                item.style.transform = 'translateX(-20px)';
                item.style.transition = 'all 0.3s ease';
                
                setTimeout(() => {
                    item.style.opacity = '1';
                    item.style.transform = 'translateX(0)';
                }, index * 100);
            });
            
            // Initialize dynamic page titles
            initializeDynamicTitles();
            
            // Add enhanced sidebar interactions
            enhanceSidebarInteractions();
        });
        
        // Dynamic page title functionality
        function initializeDynamicTitles() {
            // Get current active sidebar item
            const activeItem = document.querySelector('.sidebar-item.active');
            if (activeItem) {
                updatePageTitle(activeItem);
            }
            
            // Add click listeners to all sidebar items
            const sidebarItems = document.querySelectorAll('.sidebar-item');
            sidebarItems.forEach(item => {
                item.addEventListener('click', function() {
                    updatePageTitle(this);
                });
            });
            
            // Add click listeners to profile/user avatar links
            const profileLinks = document.querySelectorAll('a[href*="profile"], a[href*="user_profile"], a[href*="admin_profile"]');
            profileLinks.forEach(link => {
                link.addEventListener('click', function() {
                    updateHeaderTitle('Profile');
                });
            });
        }
        
        function updatePageTitle(activeItem) {
            const pageTitleElement = document.getElementById('dynamic-page-title');
            const pageDescriptionElement = document.getElementById('dynamic-page-description');
            if (!pageTitleElement || !pageDescriptionElement) return;
            
            const navText = activeItem.querySelector('.nav-text');
            if (!navText) return;
            
            const newTitle = navText.textContent;
            updateHeaderTitle(newTitle);
        }
        
        // Enhanced sidebar interactions
        function enhanceSidebarInteractions() {
            const sidebarItems = document.querySelectorAll('.sidebar-item');
            
            sidebarItems.forEach(item => {
                // Add ripple effect on click
                item.addEventListener('click', function(e) {
                    createRippleEffect(e, this);
                });
                
                // Enhanced hover effects
                item.addEventListener('mouseenter', function() {
                    if (!this.classList.contains('active')) {
                        this.style.transform = 'translateX(4px) scale(1.02)';
                    }
                });
                
                item.addEventListener('mouseleave', function() {
                    if (!this.classList.contains('active')) {
                        this.style.transform = 'translateX(0) scale(1)';
                    }
                });
            });
        }
        
        // Ripple effect for sidebar items
        function createRippleEffect(event, element) {
            const ripple = document.createElement('div');
            const rect = element.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height);
            const x = event.clientX - rect.left - size / 2;
            const y = event.clientY - rect.top - size / 2;
            
            ripple.style.cssText = `
                position: absolute;
                width: ${size}px;
                height: ${size}px;
                left: ${x}px;
                top: ${y}px;
                background: rgba(255, 255, 255, 0.3);
                border-radius: 50%;
                transform: scale(0);
                animation: ripple 0.6s linear;
                pointer-events: none;
            `;
            
            element.style.position = 'relative';
            element.appendChild(ripple);
            
            setTimeout(() => {
                ripple.remove();
            }, 600);
        }

        // Add ripple animation CSS
        if (!document.querySelector('#ripple-styles')) {
            const style = document.createElement('style');
            style.id = 'ripple-styles';
            style.textContent = `
                @keyframes ripple {
                    to {
                        transform: scale(4);
                        opacity: 0;
                    }
                }
            `;
            document.head.appendChild(style);
        }

        // User avatar functionality (simplified)
        document.addEventListener('DOMContentLoaded', function() {
            const userAvatarBtn = document.getElementById('user-avatar-btn');
            
            if (userAvatarBtn) {
                userAvatarBtn.addEventListener('click', function() {
                    // Simple click effect - can be enhanced later if needed
                    this.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        this.style.transform = 'scale(1)';
                    }, 150);
                });
            }
            
            // Enhanced dynamic header update function for user sidebar
            function updateUserHeaderFromSidebar() {
                const activeItem = document.querySelector('.sidebar-item.active');
                if (activeItem) {
                    const itemText = activeItem.querySelector('.nav-text');
                    if (itemText) {
                        const sectionName = itemText.textContent.trim();
                        
                        // Update header title and description based on selected section
                        const pageTitle = document.getElementById('dynamic-page-title');
                        const pageDescription = document.getElementById('dynamic-page-description');
                        
                        if (pageTitle && pageDescription) {
                            // Enhanced header content mapping for user sections
                            const headerContent = {
                                'Home': {
                                    title: 'Home',
                                    description: 'Welcome to your fraud detection system'
                                },
                                'Dashboard': {
                                    title: 'Dashboard',
                                    description: 'Your fraud detection dashboard and overview'
                                },
                                'Analyze New claim': {
                                    title: 'Analyze New Claim',
                                    description: 'Analyze new insurance claims for fraud detection'
                                },
                                'Reports': {
                                    title: 'Reports',
                                    description: 'View and export fraud detection reports'
                                },
                                'Profile': {
                                    title: 'User Profile',
                                    description: 'Manage your user profile and settings'
                                }
                            };
                            
                            // Update header content with smooth animation
                            const content = headerContent[sectionName] || {
                                title: sectionName,
                                description: `Your ${sectionName.toLowerCase()} section`
                            };
                            
                            // Add animation class
                            pageTitle.classList.add('animate');
                            
                            // Update content with a slight delay for smooth transition
                            setTimeout(() => {
                                pageTitle.textContent = content.title;
                                pageDescription.textContent = content.description;
                                
                                // Remove animation class after animation completes
                                setTimeout(() => {
                                    pageTitle.classList.remove('animate');
                                }, 400);
                            }, 200);
                        }
                    }
                }
            }

            // Sidebar active state management with dynamic header updates
            const sidebarItems = document.querySelectorAll('.sidebar-item');
            
            // Add click event to all sidebar items
            sidebarItems.forEach(item => {
                item.addEventListener('click', function() {
                    // Remove active class from all items
                    sidebarItems.forEach(nav => nav.classList.remove('active'));
                    // Add active class to clicked item
                    this.classList.add('active');
                    
                    // Update header immediately
                    updateUserHeaderFromSidebar();
                    
                    // Store active state in sessionStorage for persistence
                    const activeText = this.querySelector('.nav-text');
                    if (activeText) {
                        sessionStorage.setItem('activeUserSidebarItem', activeText.textContent);
                    }
                });
            });
            
            // Restore active state from sessionStorage on page load
            const lastActiveItem = sessionStorage.getItem('activeUserSidebarItem');
            if (lastActiveItem) {
                const itemToActivate = Array.from(sidebarItems).find(item => {
                    const text = item.querySelector('.nav-text');
                    return text && text.textContent === lastActiveItem;
                });
                if (itemToActivate) {
                    sidebarItems.forEach(nav => nav.classList.remove('active'));
                    itemToActivate.classList.add('active');
                    // Update header when restoring active state
                    updateUserHeaderFromSidebar();
                }
            }
        });

        // Smart message auto-hide system
        function autoHideMessages() {
            const messages = document.querySelectorAll('.message-auto-hide');
            messages.forEach((message, index) => {
                // Check if it's an error message or success message
                const isError = message.classList.contains('alert-danger') || 
                               message.classList.contains('bg-red-50') || 
                               message.classList.contains('border-red-400') ||
                               message.textContent.toLowerCase().includes('error') ||
                               message.textContent.toLowerCase().includes('denied') ||
                               message.textContent.toLowerCase().includes('failed');
                
                const isSuccess = message.classList.contains('alert-success') || 
                                 message.classList.contains('bg-green-50') || 
                                 message.classList.contains('border-green-400') ||
                                 message.textContent.toLowerCase().includes('success') ||
                                 message.textContent.toLowerCase().includes('updated') ||
                                 message.textContent.toLowerCase().includes('created');
                
                let hideDelay;
                if (isError) {
                    // Error messages: stay visible for 1 second then auto-hide
                    hideDelay = 1000;
                } else if (isSuccess) {
                    // Success messages: auto-hide after 1 second
                    hideDelay = 1000;
                } else {
                    // Other messages: auto-hide after 2 seconds
                    hideDelay = 2000;
                }
                
                setTimeout(() => {
                    if (message && message.parentElement) {
                        message.style.opacity = '0';
                        message.style.transform = 'translateY(-20px)';
                        setTimeout(() => {
                            if (message && message.parentElement) {
                                message.remove();
                            }
                        }, 500);
                    }
                }, hideDelay + (index * 100)); // Stagger messages by 100ms
            });
        }

        // Manual hide message function
        window.hideMessage = function(messageElement) {
            if (messageElement) {
                messageElement.style.opacity = '0';
                messageElement.style.transform = 'translateY(-20px)';
                setTimeout(() => {
                    if (messageElement && messageElement.parentElement) {
                        messageElement.remove();
                    }
                }, 500);
            }
        };

        // Start smart auto-hide when page loads
        setTimeout(autoHideMessages, 100);
    </script>
    
    {% block extra_js %}{% endblock %}
</body>
</html> 