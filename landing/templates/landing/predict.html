{% extends 'landing/base_with_sidebar.html' %}
{% load static %}

{% block title %}New Prediction - Fraud Detection System{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 py-8">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-4">
                Fraud Detection Analysis
            </h1>
            <p class="text-lg text-gray-600 max-w-2xl mx-auto">
                Enter claim details below to analyze potential fraud risk using our advanced AI model
            </p>
        </div>

        <!-- Progress Bar -->
        <div class="mb-8">
            <div class="bg-gray-200 rounded-full h-3 overflow-hidden">
                <div id="progressBar" class="bg-gradient-to-r from-blue-500 to-purple-500 h-full transition-all duration-500 ease-out" style="width: 0%"></div>
            </div>
            <p class="text-sm text-gray-500 mt-2 text-center" id="progressText">0% Complete</p>
        </div>

        <!-- Error Messages -->
        {% if errors %}
        <div class="bg-red-50 border-l-4 border-red-400 p-4 mb-8 rounded-lg">
            <div class="flex">
                <div class="flex-shrink-0">
                    <i class="fas fa-exclamation-triangle text-red-400"></i>
                </div>
                <div class="ml-3">
                    <h3 class="text-sm font-medium text-red-800">Please correct the following errors:</h3>
                    <div class="mt-2 text-sm text-red-700">
                        <ul class="list-disc pl-5 space-y-1">
                            {% for error in errors %}
                            <li>{{ error }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Prediction Form -->
        <form method="post" id="predictionForm" class="bg-white rounded-2xl shadow-xl p-8">
            {% csrf_token %}
            
            <!-- Personal Information Section -->
            <div class="mb-12">
                <div class="flex items-center mb-6">
                    <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-4">
                        <i class="fas fa-user text-blue-600"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800">Personal Information</h2>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Age -->
                    <div class="form-group">
                        <label for="{{ form.Age.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
                            {{ form.Age.label }}
                        </label>
                        {{ form.Age }}
                        {% if form.Age.help_text %}
                        <p class="text-sm text-gray-500 mt-1">{{ form.Age.help_text }}</p>
                        {% endif %}
                        {% for error in form.Age.errors %}
                        <p class="text-sm text-red-600 mt-1">{{ error }}</p>
                        {% endfor %}
                    </div>
                    
                    <!-- Driver Rating -->
                    <div class="form-group">
                        <label for="{{ form.DriverRating.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
                            {{ form.DriverRating.label }}
                        </label>
                        {{ form.DriverRating }}
                        {% if form.DriverRating.help_text %}
                        <p class="text-sm text-gray-500 mt-1">{{ form.DriverRating.help_text }}</p>
                        {% endif %}
                        {% for error in form.DriverRating.errors %}
                        <p class="text-sm text-red-600 mt-1">{{ error }}</p>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Vehicle Information Section -->
            <div class="mb-12">
                <div class="flex items-center mb-6">
                    <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center mr-4">
                        <i class="fas fa-car text-green-600"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800">Vehicle Information</h2>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- Vehicle Price -->
                    <div class="form-group">
                        <label for="{{ form.VehiclePrice.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
                            {{ form.VehiclePrice.label }}
                        </label>
                        {{ form.VehiclePrice }}
                        {% for error in form.VehiclePrice.errors %}
                        <p class="text-sm text-red-600 mt-1">{{ error }}</p>
                        {% endfor %}
                    </div>
                    
                    <!-- Age of Vehicle -->
                    <div class="form-group">
                        <label for="{{ form.AgeOfVehicle.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
                            {{ form.AgeOfVehicle.label }}
                        </label>
                        {{ form.AgeOfVehicle }}
                        {% for error in form.AgeOfVehicle.errors %}
                        <p class="text-sm text-red-600 mt-1">{{ error }}</p>
                        {% endfor %}
                    </div>
                    
                    <!-- Vehicle Category -->
                    <div class="form-group">
                        <label for="{{ form.VehicleCategory.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
                            {{ form.VehicleCategory.label }}
                        </label>
                        {{ form.VehicleCategory }}
                        {% for error in form.VehicleCategory.errors %}
                        <p class="text-sm text-red-600 mt-1">{{ error }}</p>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Accident Information Section -->
            <div class="mb-12">
                <div class="flex items-center mb-6">
                    <div class="w-10 h-10 bg-red-100 rounded-full flex items-center justify-center mr-4">
                        <i class="fas fa-exclamation-triangle text-red-600"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800">Accident Information</h2>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Days Policy Accident -->
                    <div class="form-group">
                        <label for="{{ form.Days_Policy_Accident.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
                            {{ form.Days_Policy_Accident.label }}
                        </label>
                        {{ form.Days_Policy_Accident }}
                        {% for error in form.Days_Policy_Accident.errors %}
                        <p class="text-sm text-red-600 mt-1">{{ error }}</p>
                        {% endfor %}
                    </div>
                    
                    <!-- Days Policy Claim -->
                    <div class="form-group">
                        <label for="{{ form.Days_Policy_Claim.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
                            {{ form.Days_Policy_Claim.label }}
                        </label>
                        {{ form.Days_Policy_Claim }}
                        {% for error in form.Days_Policy_Claim.errors %}
                        <p class="text-sm text-red-600 mt-1">{{ error }}</p>
                        {% endfor %}
                    </div>
                    
                    <!-- Past Number of Claims -->
                    <div class="form-group">
                        <label for="{{ form.PastNumberOfClaims.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
                            {{ form.PastNumberOfClaims.label }}
                        </label>
                        {{ form.PastNumberOfClaims }}
                        {% for error in form.PastNumberOfClaims.errors %}
                        <p class="text-sm text-red-600 mt-1">{{ error }}</p>
                        {% endfor %}
                    </div>
                    
                    <!-- Police Report Filed -->
                    <div class="form-group">
                        <label for="{{ form.PoliceReportFiled.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
                            {{ form.PoliceReportFiled.label }}
                        </label>
                        {{ form.PoliceReportFiled }}
                        {% for error in form.PoliceReportFiled.errors %}
                        <p class="text-sm text-red-600 mt-1">{{ error }}</p>
                        {% endfor %}
                    </div>
                    
                    <!-- Witness Present -->
                    <div class="form-group">
                        <label for="{{ form.WitnessPresent.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
                            {{ form.WitnessPresent.label }}
                        </label>
                        {{ form.WitnessPresent }}
                        {% for error in form.WitnessPresent.errors %}
                        <p class="text-sm text-red-600 mt-1">{{ error }}</p>
                        {% endfor %}
                    </div>
                    
                    <!-- Number of Suppliments -->
                    <div class="form-group">
                        <label for="{{ form.NumberOfSuppliments.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
                            {{ form.NumberOfSuppliments.label }}
                        </label>
                        {{ form.NumberOfSuppliments }}
                        {% for error in form.NumberOfSuppliments.errors %}
                        <p class="text-sm text-red-600 mt-1">{{ error }}</p>
                        {% endfor %}
                    </div>
                    
                    <!-- Address Change Claim -->
                    <div class="form-group">
                        <label for="{{ form.AddressChange_Claim.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
                            {{ form.AddressChange_Claim.label }}
                        </label>
                        {{ form.AddressChange_Claim }}
                        {% for error in form.AddressChange_Claim.errors %}
                        <p class="text-sm text-red-600 mt-1">{{ error }}</p>
                        {% endfor %}
                    </div>
                    
                    <!-- Deductible -->
                    <div class="form-group">
                        <label for="{{ form.Deductible.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
                            {{ form.Deductible.label }}
                        </label>
                        {{ form.Deductible }}
                        {% if form.Deductible.help_text %}
                        <p class="text-sm text-gray-500 mt-1">{{ form.Deductible.help_text }}</p>
                        {% endif %}
                        {% for error in form.Deductible.errors %}
                        <p class="text-sm text-red-600 mt-1">{{ error }}</p>
                        {% endfor %}
                    </div>
                    
                    <!-- Fault -->
                    <div class="form-group">
                        <label for="{{ form.Fault.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
                            {{ form.Fault.label }}
                        </label>
                        {{ form.Fault }}
                        {% for error in form.Fault.errors %}
                        <p class="text-sm text-red-600 mt-1">{{ error }}</p>
                        {% endfor %}
                    </div>
                    
                    <!-- Accident Area -->
                    <div class="form-group">
                        <label for="{{ form.AccidentArea.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
                            {{ form.AccidentArea.label }}
                        </label>
                        {{ form.AccidentArea }}
                        {% for error in form.AccidentArea.errors %}
                        <p class="text-sm text-red-600 mt-1">{{ error }}</p>
                        {% endfor %}
                    </div>
                    
                    <!-- Base Policy -->
                    <div class="form-group">
                        <label for="{{ form.BasePolicy.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
                            {{ form.BasePolicy.label }}
                        </label>
                        {{ form.BasePolicy }}
                        {% for error in form.BasePolicy.errors %}
                        <p class="text-sm text-red-600 mt-1">{{ error }}</p>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Submit Button -->
            <div class="text-center pt-8">
                <button type="submit" id="submitBtn" class="group relative inline-flex items-center justify-center px-8 py-4 text-lg font-semibold text-white bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-blue-300">
                    <span class="absolute inset-0 bg-gradient-to-r from-blue-700 to-purple-700 rounded-xl opacity-0 group-hover:opacity-100 transition-opacity duration-200"></span>
                    <span class="relative flex items-center">
                        <i class="fas fa-search mr-3"></i>
                        Analyze for Fraud Detection
                    </span>
                </button>
            </div>
        </form>
    </div>
</div>

<style>
    /* Custom form styling */
    .form-group input,
    .form-group select {
        @apply w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200;
    }
    
    .form-group input:focus,
    .form-group select:focus {
        @apply shadow-lg;
    }
    
    .form-group input.error,
    .form-group select.error {
        @apply border-red-500 focus:ring-red-500 focus:border-red-500;
    }
    
    /* Loading state */
    .loading {
        @apply opacity-50 pointer-events-none;
    }
    
    /* Success animation */
    @keyframes successPulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
    }
    
    .success-pulse {
        animation: successPulse 0.6s ease-in-out;
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('predictionForm');
    const progressBar = document.getElementById('progressBar');
    const progressText = document.getElementById('progressText');
    const submitBtn = document.getElementById('submitBtn');
    const formFields = form.querySelectorAll('input, select');
    
    // Update progress bar
    function updateProgress() {
        const filledFields = Array.from(formFields).filter(field => {
            if (field.type === 'number') {
                return field.value !== '';
            }
            return field.value !== '' && field.value !== 'Select the range of days since the policy accident.' && 
                   field.value !== 'Select the range of days since the policy claim.' &&
                   field.value !== 'Select the number of past claims.' &&
                   field.value !== 'Select the price range of the vehicle.' &&
                   field.value !== 'Select whether a police report was filed.' &&
                   field.value !== 'Select whether a witness was present.' &&
                   field.value !== 'Select the number of supplements.' &&
                   field.value !== 'Select the address change period for the claim.' &&
                   field.value !== 'Select the driver rating from 1 to 4.' &&
                   field.value !== 'Select the age of the vehicle.' &&
                   field.value !== 'Select who was at fault.' &&
                   field.value !== 'Select the accident area.' &&
                   field.value !== 'Select the base policy type.' &&
                   field.value !== 'Select the vehicle category.';
        }).length;
        
        const totalFields = formFields.length;
        const progress = Math.round((filledFields / totalFields) * 100);
        
        progressBar.style.width = progress + '%';
        progressText.textContent = progress + '% Complete';
        
        // Change progress bar color based on completion
        if (progress >= 80) {
            progressBar.className = 'bg-gradient-to-r from-green-500 to-blue-500 h-full transition-all duration-500 ease-out';
        } else if (progress >= 50) {
            progressBar.className = 'bg-gradient-to-r from-yellow-500 to-orange-500 h-full transition-all duration-500 ease-out';
        } else {
            progressBar.className = 'bg-gradient-to-r from-blue-500 to-purple-500 h-full transition-all duration-500 ease-out';
        }
    }
    
    // Add event listeners to form fields
    formFields.forEach(field => {
        field.addEventListener('input', updateProgress);
        field.addEventListener('change', updateProgress);
        
        // Add focus effects
        field.addEventListener('focus', function() {
            this.parentElement.classList.add('success-pulse');
        });
        
        field.addEventListener('blur', function() {
            this.parentElement.classList.remove('success-pulse');
        });
    });
    
    // Form submission
    form.addEventListener('submit', function(e) {
        submitBtn.disabled = true;
        submitBtn.innerHTML = `
            <span class="relative flex items-center">
                <i class="fas fa-spinner fa-spin mr-3"></i>
                Analyzing...
            </span>
        `;
        form.classList.add('loading');
    });
    
    // Initialize progress
    updateProgress();
    
    // Add smooth entrance animation
    const sections = document.querySelectorAll('.mb-12');
    sections.forEach((section, index) => {
        section.style.opacity = '0';
        section.style.transform = 'translateY(20px)';
        section.style.transition = 'all 0.6s ease';
        
        setTimeout(() => {
            section.style.opacity = '1';
            section.style.transform = 'translateY(0)';
        }, index * 200);
    });
});
</script>
{% endblock %} 